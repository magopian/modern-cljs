# Tutorial 1 - The Basics

In this first tutorial we are going to create and configure a minimum
ClojureScript ([CLJS][1]) project by using the [boot][2] build tool.

## Requirements

This tutorial requires Java and `boot` to be installed on your
computer.

To install Java follow the [instructions][3] for your operating
system. To install `boot` follow the very easy instructions in the
corresponding section of its [README][4].

Test the installation by issuing the `boot -h` command at the
terminal. Then submit the `boot -u` command to get the latest `boot`
updates.

## Create the project structure

A minimum CLJS web project is composed of 3 files:

* an html page;
* a CLJS source code;
* a `boot` build file to compile CLJS source code.

Even if CLJS does not dictate specific directory structure, it's a
good practice to organize your project in such a way that it will be
easy for anyone, even yourself in a few months, to be able to
understand the project components and its structure. Moreover, each
building tool has its own idiosyncrasies, which they call
defaults. The more you adhere to the defaults of the tool in your
hand, the less it will be your pain in managing the project.

By taking into accounts these premies, let's create a directory
structure for our new project, named `modern-cljs`, by adhering as
much as possibile to the `boot` defaults.

The suggested directory layout of the project is the following:

```bash
modern-cljs/
├── build.boot
├── html
│   └── index.html
└── src
    └── cljs
        └── modern_cljs
            └── core.cljs
```

* `modern-cljs` is the home directory of the project;
* `src/cljs/` hosts CLJS source files;
* `html` hosts html resources;

    > NOTE 1: Single segment namespace are
    > [discouraged in CLJ/CLJS][5]. That's why we created the
    > `modern_cljs` directory as well. Due to [Java difficulties][6]
    > in managing hyphen "-" (or other special characters) in package
    > names, we substituted an underscore (`_`)for any hyphen (`-`) in
    > corresponding directory names.

    > NOTE 2: Please note that the filename extension for
    > ClojureScript source is *cljs*, not *clj*.

Issue the following command at the teminal:

```bash
mkdir -p modern-cljs/{src/cljs/modern_cljs,html}
```

Let's now create the three needed files by issuing the folowing
command:

```bash
cd modern-cljs
touch html/index.html src/cljs/modern_cljs/core.cljs build.boot
```

## Hello World in CLJS

We're now going to write our very first CLJS code. Open the
`src/cljs/modern_cljs/core.cljs` file with your preferred editor and
type into it the following CLJS code:

```clj
;; create the main project namespace
(ns modern-cljs.core)

;; enable cljs to print to the JS console of the browser
(enable-console-print!)

;; print to the console
(println "Hello, World!")
```

Every CLJ/CLJS file must start with a namespace declaration matching a
path on your disk:

`(ns modern-cljs.core)` <--> `modern_cljs/core.cljs`

The `(enable-console-print!)` expression redirects any printing output
to the console of the browser, while the `(println "Hello, world!")`
prints `Hello, World!` to the console.

### Minimal build.boot

We now need a way to compile down `core.cljs` to JS and link it to the
`index.html` page.

Open the file `html/index.html` and edit it as follow:

```html
<!doctype html>
<html>
  <head>
    <title>Hello, World!</title>
  </head>
  <body>
    <script src="main.js"></script>
  </body>
</html>
```

Note that there are no references to CLJS files. We only added a
`<script>` tag to link the `index.html` page to the `main.js`
file. This JS file will be generated by the `boot` building tool while
compiling the above `core.cljs` source code.

To compile the `core.cljs` file, we need to instruct `boot` command by
editing the `build.boot` file, which is just a regular CLJ file with a
different extension:

```clj
(set-env!
 :source-paths #{"src/cljs"}
 :resource-paths #{"html"}

 :dependencies '[[adzerk/boot-cljs "1.7.48-6"]])

(require '[adzerk.boot-cljs :refer [cljs]])
```

Pretty minimal! The `set-env` function sets `:source-paths` and
`:resource-paths` keywords to the corresponding values of the project
structure as we have created above. Then it injects the `boot-cljs`
compilation task as the only explicit dependency of the project by
adding it to the `:dependencies` keyword.

Note that even if we did not include any `clojure` and `clojurescript`
dependencies, `boot` will be able to automagically download the
corresponding releases it knows to work well with it.

Finally, the `require` form makes the `cljs` task visible to the
`boot` command.

If you now run the `boot -h` command from the terminal, you'll see
that the `cljs` task is now available to `boot`.

```bash
boot -h
Boot App Version: 2.0.0-pre14
Boot Lib Version: 2.1.2
Clojure Version:  1.7.0

Usage:   boot OPTS <task> TASK_OPTS <task> TASK_OPTS ...

...

Tasks:   add-repo                   Add all files in project git repo to ...

         zip                        Build a zip file for the project.

         cljs                       Compile ClojureScript applications.
...

Do `boot <task> -h` to see usage info and TASK_OPTS for <task>.
```

We can even have more information about the `cljs` task by issuing the
following command:

```bash
boot cljs -h
Compile ClojureScript applications.
...
Available --optimization levels (default 'none'):
...
```

As you see, the default optimization directive for the CLJS compiler
is `none`. A next tutorial will explain the different CLJS compilation
optimizations (i.e. `none`, `whitespace`, `simple` and `advanced`). At
the moment stay with `none`, which is the more used during development
cycle. Let's see `'boot cljs` at work:

```bash
boot cljs
Writing main.cljs.edn...
Compiling ClojureScript...
• main.js
```

You now know why we named as `main.js` the JS file included in the
`<script>` tag of the `index.html` page: just to adhere to an easy
default to be used.

Let's see what has been generated by the `cljs` compilation task:

```bash
.
├── boot.properties
├── build.boot
├── html
│   └── index.html
├── src
│   └── cljs
│       └── modern_cljs
│           └── core.cljs
└── target
    ├── index.html
    ├── main.js
    └── main.out
        ├── boot
        │   └── cljs
        │       ├── main494.cljs
        │       ├── main494.cljs.cache.edn
        │       ├── main494.js
        │       └── main494.js.map
        ├── cljs
        │   ├── core.cljs
        │   ├── core.js
        │   └── core.js.map
        ├── cljs_deps.js
        ├── goog
        │   ├── array
        │   │   └── array.js
        │   ├── asserts
        │   │   └── asserts.js
        │   ├── base.js
        │   ├── debug
        │   │   └── error.js
        │   ├── deps.js
        │   ├── dom
        │   │   └── nodetype.js
        │   ├── object
        │   │   └── object.js
        │   └── string
        │       ├── string.js
        │       └── stringbuffer.js
        └── modern_cljs
            ├── core.cljs
            ├── core.cljs.cache.edn
            ├── core.js
            └── core.js.map

17 directories, 27 files
```

WOW, a lot of stuff. As you see the original directory structure is
untouched. Everything, even the `index.html` resource, has been
generated into the default `target` directory.

So far, so good.

## Visit index.html

`boot` uses a pretty neat approach in taking apart the input of the
project from the corresponding output generated by its taks. You'll
never see an input file from the `:source-paths` and the
`:resource-path` original directories to be modified by any `boot`
task. Aside from internally generated temporary directories,
everything happens into the `target` directory.

Open a browser and visit the local `target/index.html` file. Now open
the console in your Development Tool (e.g. Chrome Development Tool).
If everything went ok, you should see "Hello, World!" printed in the
console.

It's a good practice to save into the `boot.properties` file the
version of boot core libraries and clojure language used in the
project by issuing the following command at the terminal:

```bash
boot -V > boot.properties
```

Finally, I strongly suggest to use `git` to manage your work.

```bash
git init
echo '/target' > .gitignore
git add .
git commit -m "initial commit"
```

## Next
Step - [Tutorial 2: Immediate Feedback Principle][7]

In the next [tutorial][7] we're going to approach as close as possible
the [Bret Victor Immediate Feedback Principle][8] to build a very
interactive development environment.

# License

Copyright © Mimmo Cosenza, 2012-2015. Released under the Eclipse Public
License, the same as Clojure.

[1]: https://github.com/clojure/clojurescript.git
[2]: http://boot-clj.com/
[3]: https://java.com/en/download/help/index_installing.xml?os=All+Platforms&j=8&n=20
[4]: https://github.com/boot-clj/boot#install
[5]: http://stackoverflow.com/questions/13567078/whats-wrong-with-single-segment-namespaces
[6]: http://docs.oracle.com/javase/specs/jls/se8/html/jls-6.html
[7]: https://github.com/magomimmo/modern-cljs/blob/master/doc/tutorial-02.md
[8]: https://vimeo.com/36579366
